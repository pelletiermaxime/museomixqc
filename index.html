<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="scenejs.js"></script>
    <script src="keymaster.js"></script>
</head>
<body>
	<style>
		body  { border: 0; margin: 0; overflow: hidden;  }
		video {  display: block; margin: 0; width:50%; height: auto; }
	</style>

	<video id="video" width="1920" height="1080" autoplay style="display: none"></video>
    <canvas id="bc" width="1920" height="1080"  style="display: block;position: absolute; width: 100%; height: auto;left: 0;top:0;z-index:0"></canvas>
    <canvas id="fc" width="1920" height="1080"  style="display: block;position: absolute; width: 100%; height: auto;left: 0;top:0;z-index:999"></canvas>

	<script>

		// Put event listeners into place
		window.addEventListener("DOMContentLoaded", function() {
			// Grab elements, create settings, etc.
				video = document.getElementById("video"),
				videoObj = { "video": true },
				errBack = function(error) {
					console.log("Video capture error: ", error.code); 
				};

			// Put video listeners into place
			if(navigator.getUserMedia) { // Standard
				navigator.getUserMedia(videoObj, function(stream) {
					video.src = stream;
					video.play();
				}, eorrBack);
			} else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
				navigator.webkitGetUserMedia(videoObj, function(stream){
					video.src = window.webkitURL.createObjectURL(stream);
					video.play();
				}, errBack);
			} else if(navigator.mozGetUserMedia) { // WebKit-prefixed
				navigator.mozGetUserMedia(videoObj, function(stream){
					video.src = window.URL.createObjectURL(stream);
					video.play();
				}, errBack);
			}

		}, false);


        document.addEventListener('DOMContentLoaded', function(){
            var wtf_white_people = new Image();
            wtf_white_people.src = 'img/shadow.png';

            var v = document.getElementById('video');
            var fcanvas = document.getElementById('fc');
            var bcanvas = document.getElementById('bc');
            var fc = fcanvas.getContext('2d');
            var bc = bcanvas.getContext('2d');

            var $3d_canvas = $("#canvas-1");


            v.addEventListener('play', function(){
                draw();
            },false);

            function draw() {
                if(v.paused || v.ended) return false;
                fc.drawImage(v,0,0, 1920, 1080);
                fc.globalCompositeOperation = 'destination-out';

                fc.beginPath();
                fc.moveTo(353, 0);
                fc.lineTo(1920,0);
                fc.lineTo(1920, 500);
                fc.lineTo(900, 760);
		fc.lineTo(895, 785);
                fc.lineTo(355, 960);
                fc.closePath();
                fc.fill();
                fc.globalCompositeOperation = 'source-over'
                
                bc.drawImage(v,0,0, 1920, 1080);
                if($3d_canvas.is(":visible"))
                    bc.drawImage(wtf_white_people,0,0, 1920, 1080);

                window.requestAnimationFrame(draw);
            }

        },false);

// Using the "import/obj" node to import a raptor mesh from .OBJ format
// Internally, the node uses the K3D library for parsing - http://k3d.ivank.net/

// Point SceneJS to the bundled plugins
SceneJS.setConfigs({
    pluginPath: "../plugins"
});

// Create a scene
var scene = SceneJS.createScene({
    
    transparent: true,
    nodes: [

        // Mouse-orbited camera,implemented by plugin at
        // http://scenejs.org/api/latest/plugins/node/cameras/orbit.js
        {
            type: "cameras/orbit",
            yaw: -10,
            pitch: -10,
            zoom: 2000,
            zoomSensitivity: 20.0,

            nodes: [

                // Move the raptor a bit to centre it
                {
                    id: "myMaterial",
                    type: "translate", y: -60, z: -5, x: 25,
                    nodes: [
                        {
                            type: "texture",
                            src: "models/obj/statueLR.bmp",

                            nodes:[
                            {
                                type:"rotate",
                                id:"myRotate",
                                y:1.0,
                                angle:0,

                                nodes: [
                                    {
                                        type: "import/obj",
                                        src: "models/obj/statueLR.obj"
                                    }
                                ]
                            }
                        ]
                        },
                                           ],
                }
            ]
        }
    ]
});

</script>
</body>
</html>
